!function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","codemirror"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("codemirror")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror)}(this,function(a,b,c){"use strict";function d(c,d,f){this.actions=d.actions,this.actionIndex=-1,this.state=e,this.timerQueue=[],this.timers=[],this.editor=c,this.locale=f.locale,this.$container=f.container||b("body");for(var g in this.availableActions)a.isFunction(this.availableActions[g].init)&&this.availableActions[g].init.call(this);this.LINE_HEIGHT=18,this.CHAR_WIDTH=7;var h=d.code||c.value||"";c.value=h;var i=h.indexOf("|");i!=-1&&c.setCursor(c.posFromIndex(i)),c&&!c.__initial&&(c.__initial={content:c.getValue(),pos:c.getCursor(!0)})}var e="idle",f="play",g="pause",h=null,i=/\s+/,j={beforeDelay:0,afterDelay:0},k={Play:"Play",Replay:"Replay",Next:"Next",Back:"Back",Stop:"Pause","Click on these blue things to continue.":"Click on these blue messages to continue.","Show difference":"Show difference","Compile and test":"Compile and test"};return d.prototype={availableActions:{},fastForward:!1,play:function(){if(this.state!==f){if(this.state===g){this.editor.focus();for(var a=null;a=this.timerQueue.shift();)this.setTimeout(a.fn,a.delay);return this.state=f,void this.trigger("resume")}this.reset(),this.state=f,this.trigger("play"),this.next(j.beforeDelay)}},next:function(){this.cleanup();for(var a;this.actionIndex<this.actions.length-1;){if(this.actionIndex++,this.trigger("action",this.actionIndex),a=this.actions[this.actionIndex],!this.hasAction(a.type))throw"No such action: "+a.type;if(this.isCorrectLocale(a))return this.isReversableAction(a.type)&&this.saveActionState(a),void this.getAction(a.type)(a.options)}if(this.actionIndex>=this.actions.length-1)return this.timer(function(){this.stop()},j.afterDelay)},saveActionState:function(b){b.state={value:this.editor.getValue(),cursor:this.editor.getCursor(),selection:this.editor.doc.listSelections(),step:this.step},a.isFunction(this.availableActions[b.type].saveState)&&this.availableActions[b.type].saveState.call(this,b)},back:function(){this.cleanup();for(var a;this.actionIndex>0;){if(this.actionIndex--,a=this.actions[this.actionIndex],!this.hasAction(a.type))throw"No such action: "+a.type;if(this.isCorrectLocale(a)&&this.isReversableAction(a.type))return this.revertActionState(a),this.trigger("action",this.actionIndex),void this.getAction(a.type)(a.options)}0==this.actionIndex&&this.reset()},revertActionState:function(b){b.state&&(this.editor.setValue(b.state.value),this.editor.setCursor(b.state.cursor),this.editor.setSelections(b.state.selection),this.setStep(b.state.step),a.isFunction(this.availableActions[b.type].revertState)&&this.availableActions[b.type].revertState.call(this,b))},cleanup:function(){this.cleanupFunc.length&&(this.cleanupFunc.forEach(function(a){a()}),this.cleanupFunc=[]),this.timers.forEach(function(a){clearTimeout(a)}),this.timers=[]},timer:function(b,c){return b=a.bind(b,this),this.state===f?this.setTimeout(b,this.fastForward?0:c):void this.timerQueue.push({fn:b,delay:c})},setTimeout:function(b,c){var d=this;if(c){var e=setTimeout(function(){b(),d.timers=a.filter(d.timers,function(a){return a!=e})},c);return d.timers.push(e),e}b()},pause:function(){this.state=g,this.trigger("pause")},stop:function(){this.state!==e&&(this.state=e,this.timerQueue.length=0,this.trigger("stop"))},reset:function(){this.state=e,this.cleanupFunc=[],this.actionIndex=-1,this.setStep(0),this.editor.execCommand("revert"),this.trigger("reset")},setFastForward:function(a){this.fastForward=a,this.trigger("fastForward",a)},getState:function(){return this.state},toggle:function(){this.state===f?this.pause():this.play()},on:function(a,b,c){var d,e,f,g,h;if(!b)return this;for(a=a.split(i),d=this._callbacks||(this._callbacks={});e=a.shift();)h=d[e],f=h?h.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:h?h.next:f};return this},off:function(b,c,d){var e,f,g,h,j,k;if(f=this._callbacks){if(!(b||c||d))return delete this._callbacks,this;for(b=b?b.split(i):a.keys(f);e=b.shift();)if(g=f[e],delete f[e],g&&(c||d))for(h=g.tail;(g=g.next)!==h;)j=g.callback,k=g.context,(c&&j!==c||d&&k!==d)&&this.on(e,j,k);return this}},trigger:function(a){var b,c,d,e,f,g,h;if(!(d=this._callbacks))return this;for(g=d.all,a=a.split(i),h=Array.prototype.slice.call(arguments,1);b=a.shift();){if(c=d[b])for(e=c.tail;(c=c.next)!==e;)c.callback.apply(c.context||this,h);if(c=g)for(e=c.tail,f=[b].concat(h);(c=c.next)!==e;)c.callback.apply(c.context||this,f)}return this},setStep:function(c){this.step=c;var d=b(this.editor.display.wrapper).closest(".codeplayer"),e=b(".codeplayer-roadmap",d),f=b(".step",e).length;if(e.addClass("fastForward"),"all"==c||a.isNumber(c)&&(c==-1||c>b(".codeplayer-roadmap .step",d).length))b(".step",e).removeClass("active").removeClass("transitioned").addClass("completed"),e.addClass("completed");else if(a.isNumber(c)){e.removeClass("completed");for(var g=1;g<c;g++)b(".step:nth-child("+g+")",e).removeClass("active").removeClass("transitioned").addClass("completed");for(var g=c+1;g<=f;g++)b(".step:nth-child("+g+")",e).removeClass("active").removeClass("transitioned").removeClass("completed");b(".step:nth-child("+c+")",e).removeClass("completed").addClass("active").addClass("transitioned")}setTimeout(function(){e.removeClass("fastForward")},1)},scrollToTarget:function(c,d){if(this.fastForward&&(d=0),d=a.isNumber(d)?d:300,this.$container[0]==b("body")[0])var e=null==h?b(window).scrollTop():h,f=Math.max(document.documentElement.clientHeight,window.innerHeight||0),g=c instanceof b?c.offset().top:c;else var e=null==h?this.$container.scrollTop():h,f=Math.max(document.documentElement.clientHeight,this.$container.height()),g=(c instanceof b?c.offset().top:c)+this.$container.scrollTop();var i=c instanceof b?c.height():0,j=20,k=null;g<e?k=g-j:g+i>e+f&&(k=g+i-f+j),null!=k&&(h=k,d?this.$container.animate({scrollTop:k},d,function(){h=null}):(this.$container.scrollTop(k),h=null))},resolvePosition:function(b){function c(a){return"left"in a&&(a.x=a.left),"top"in a&&(a.y=a.top),a}if("caret"===b)return c(this.editor.cursorCoords(!0));if(a.isObject(b)){if("x"in b&&"y"in b)return b;if("left"in b&&"top"in b)return c(b)}return c(this.editor.charCoords(this.makePos(b),"page"))},hasAction:function(a){return"undefined"!=typeof this.availableActions[a]},getAction:function(b){return a.bind(this.availableActions[b],this)},isReversableAction:function(a){return this.availableActions[a].reversable},isCorrectLocale:function(b){return a.isUndefined(this.locale)||a.isUndefined(b.options.locale)||this.locale&&b.options.locale==this.locale},makePos:function(b){if(a.isString(b)){if("caret"===b)return this.editor.getCursor(!0);if(~b.indexOf(":")){var c=b.split(":");return{line:parseInt(c[0],10),ch:parseInt(c[1],10)}}b=parseInt(b,10)}return a.isNumber(b)?this.editor.posFromIndex(b):b}},d.create=function(e,f,g){if(g=a.extend({},j,g||{}),g.locale=g.locale||"en",void 0===g.mode&&void 0!==f.lang){var h={java:"text/x-java",cpp:"text/x-c++hdr",csharp:"text/x-csharp",php:"text/x-php",delphi:"text/x-pascal",python:"text/x-python"};g.mode=h[f.lang]}var i=b(e);i.empty().addClass("codeplayer idle"),b(".tooltip-target").remove(),b(".tooltip").remove();var l=a.extend(k,g.translation||{});if(f.steps&&f.steps.length){for(var m=b('<div class="codeplayer-roadmap"></div>'),n=0;n<f.steps.length;n++){var o=a.isObject(f.steps[n])?f.steps[n][g.locale]:f.steps[n],p=b('<div class="step"><div class="step-content">'+o+"</div></div>");m.append(p)}i.append(m),b("a",m).attr("target","_blank")}var q=b('<div class="codeplayer-screen-wrapper"></div>');i.append(q);var r=b('<div class="codeplayer-screen"></div>');q.append(r),g.diff="undefined"!=typeof c.MergeView&&g.diff,g.mode=g.mode||"",g.edit_mode=g.edit_mode||!1;var s,t;if(g.diff){s={value:f.code,origRight:f.code,lineNumbers:!0,showDifferences:!1,viewportMargin:1/0,readOnly:!g.edit_mode,dragDrop:g.edit_mode,autofocus:!1,inputStyle:"textarea"};var u=c.MergeView(r[0],a.extend(s,g));u.right.orig.setOption("lineNumbers",!1),t=u.edit,t.diff=u}else s={value:f.code,lineNumbers:!0,viewportMargin:1/0,readOnly:!g.edit_mode,dragDrop:g.edit_mode,autofocus:!1,inputStyle:"textarea"},t=c(r[0],a.extend(s,g));r.data("CodeMirror",t);var v=t.player=new d(t,f,g);if(!g.edit_mode){var w=b('<div class="codeplayer-typing-shield"></div>');t.display.wrapper.appendChild(w[0]),v.on("play resume",function(){w.addClass("active"),t.getInputField().blur()}),v.on("stop",function(){w.removeClass("active")}),v.on("pause",function(){w.removeClass("active")})}if(!f.ready)for(var n=0;n<f.actions.length;n++)if("popover"==f.actions[n].type&&(!f.actions[n].options.locale||f.actions[n].options.locale==g.locale)){f.actions[n].options.text+='<p><small class="blinking-tooltip-text">'+l["Click on these blue things to continue."]+"</small></p>";break}var x=b('<div class="codeplayer-controls"></div>'),y=function(a){var c=b('<button type="button" class="btn"></button>').addClass(a.buttonClass).attr("title",a.title);return c.icon=b('<span class="icon"></span>').addClass(a.iconClass),c.title=b('<span class="title"></span>').addClass(a.titleClass).html(a.title),c.append(c.icon).append(c.title),c},z=y({title:l.Play,buttonClass:"btn-success btn-embossed codeplayer-play",iconClass:"fa fa-play",titleClass:"idle-only"});z.bind("click",function(){"play"==v.getState()?v.pause():v.play()}),x.append(z);var A=b('<div class="btn-group" role="group"></div>'),B=y({title:l.Back,buttonClass:"btn-success btn-embossed codeplayer-back",iconClass:"fa fa-angle-left"});B.bind("click",function(){v.back()}),A.append(B);var C=y({title:l.Next,buttonClass:"btn-success btn-embossed codeplayer-next",iconClass:"fa fa-angle-right"});if(C.bind("click",function(){v.next()}),A.append(C),x.append(A),g.diff){var D=y({title:l["Show difference"],buttonClass:"btn-default btn-embossed codeplayer-diff",iconClass:"fa fa-eye"});D.bind("click",function(){i.toggleClass("diff"),u.setShowDifferences(i.is(".diff")),D.toggleClass("btn-success"),D.icon.toggleClass("fa-eye-slash"),setTimeout(function(){t.refresh(),u.right.orig.refresh(),t.display.scrollbars.setScrollLeft(0)},1e3)}),x.append(D),v.on("stop",function(){D.trigger("click")}),D.hide()}var E=!1;if(f.actions.every(function(a,b){return"compile"!=f.actions[b].type&&"readyAndCompile"!=f.actions[b].type||(E=!0,!1)}),E){var F=y({title:l["Compile and test"],buttonClass:"btn-default btn-embossed codeplayer-compile",iconClass:"fa fa-bug"});x.append(F)}return v.on("stop",function(){z.attr("title",l.Replay),z.icon.attr("class","fa fa-refresh"),z.title.html(z.attr("title")),A.addClass("hidden"),z.removeClass("hidden")}),v.on("play resume",function(){i.removeClass("idle"),z.attr("title",l.Stop),z.icon.attr("class","fa fa-pause"),z.title.html(z.attr("title")),A.removeClass("hidden"),z.addClass("hidden")}),v.on("pause",function(){z.attr("title",l.Play),z.icon.attr("class","fa fa-play"),z.title.html(z.attr("title")),A.removeClass("hidden"),z.addClass("hidden")}),v.on("reset",function(){i.addClass("idle"),z.attr("title",l.Play),z.icon.attr("class","fa fa-play"),z.title.html(z.attr("title")),z.removeClass("hidden"),A.addClass("hidden"),g.diff&&(i.removeClass("diff"),u.setShowDifferences(!1),D.removeClass("btn-success"))}),q.prepend(x),f.ready=!0,v},d.attach=function(b,c,e){return e=a.extend({},j,e||{}),new d(b,c,e)},c.player=d,c.commands.revert=function(a){a.__initial&&(a.setValue(a.__initial.content),a.setCursor(a.__initial.pos))},d}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer","codemirror","../utils/syntax"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer"),require("codemirror"),require("syntax")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player,a.CodeMirror)}(this,function(a,b,c,d){c.prototype.getLocationRange=function(a,c,e,f){function g(a,b){return l.findPosH(a,b,"char",!1)}function h(a,b){var c=a.match(/(?:([a-zA-Z0-9_\\$]+?) )?([a-zA-Z0-9_\\$]+?)$/),d=c[1],e=c[2],f={start:"^([^\\S\\n]*)","class":{visibility:"((private|protected|public|internal)\\s+)?","abstract":"((abstract|virtual|static|partial)\\s+)?","class":"((class)\\s+)",name:"([a-zA-Z0-9_<>\\\\.]+)","super":"((?:\\s+extends|\\s*:)\\s+([a-zA-Z0-9_<>\\\\. ]+)\\s*)?","interface":"((?:\\s+implements|\\s*\\,)\\s+([a-zA-Z0-9_<>\\\\., ]+)\\s*)?"},method:{override:"(?:@Override\\s+)?",visibility:"((private|protected|public|internal)\\s+)?","static":"((override|static|abstract|virtual)\\s+)?",type:"(([a-zA-Z0-9_<>\\$]+?)\\s+)?",name:"([a-zA-Z0-9_<>\\$]+?)",parameters:"\\s*\\(([^;\\(\\{\\}]*?)\\)",base:"(\\s*:\\s*(base|this)\\([a-zA-Z0-9_<>\\\\., ]*\\))?"},end:"\\s*"},g=f.start;return d||(d=b.match(RegExp(f["class"]["class"]+"("+e+")","im"),null,!0)?"class":null),g+="class"==d?f["class"].visibility+f["class"]["abstract"]+f["class"]["class"]+"("+e+")"+f["class"]["super"]+f["class"]["interface"]:"public"==d||"private"==d||"protected"==d?f.method.override+"(("+d+")\\s+)(())(())("+e+")"+f.method.parameters+f.method.base:"static"==d?f.method.override+f.method.visibility+"(("+d+")\\s+)(())("+e+")"+f.method.parameters+f.method.base:d?f.method.override+f.method.visibility+f.method["static"]+"(("+d+")\\s+)("+e+")"+f.method.parameters+f.method.base:f.method.override+f.method.visibility+f.method["static"]+f.method.type+"("+e+")"+f.method.parameters+f.method.base,g+=f.end,{type:d,regexp:g}}function i(a,b){if(b=b||{anchor:d.Pos(0,0),head:d.Pos(l.doc.lastLine())},!a)return b;var c=l.doc.getRange(b.anchor,b.head);k=h(a,c);var e=c.match(RegExp(k.regexp+"\\{","im"),null,!0);if(!e)throw'Method or class "'+a+'" can not be found in source text.';var f={};f.anchor=g(b.anchor,e.index+e[0].length),f.head=l.findMatchingBracket(f.anchor,!1).to,f.before=g(b.anchor,e.index-1),f.after=g(f.head,1),f.start=d.Pos(f.anchor.line,f.anchor.ch),f.end=d.Pos(f.head.line,f.head.ch);var i=""==l.doc.getLine(f.end.line).slice(0,f.end.ch).trim();return i&&f.end.line>0&&(f.end.line--,f.end.ch=l.doc.getLine(f.end.line).length),f}function j(a,c,e){if(!c)return e;m=b.extend({},e);var f=l.getSearchCursor("(",m.start,{caseFold:!0,multiline:!1});f.findPrevious()&&(m.parameters=d.Pos(f.from().line,f.from().ch+1));var f=l.getSearchCursor(")",m.start,{caseFold:!0,multiline:!1});switch(f.findPrevious()&&(m["parameters end"]=f.from()),c){case"name":case"visibility":case"static":case"abstract":case"type":case"super":case"interface":var h={},i=l.getSearchCursor(RegExp(k.regexp,"i"),m.start,{caseFold:!0,multiline:!1});if(!i.findPrevious())throw'Signature of "'+a+'" can not be found.';if("class"==k.type){var j=1,n=g(i.pos.from,i.pos.match[j].length);if(j++,i.pos.match[j]&&(h.visibility={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[j+1].trim().length)},n=g(n,i.pos.match[j].length)),j+=2,i.pos.match[j]&&(h["abstract"]={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[j+1].trim().length)},n=g(n,i.pos.match[j].length)),j+=2,i.pos.match[j]&&(h.type={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[j+1].trim().length)},n=g(n,i.pos.match[j].length)),j+=2,i.pos.match[j]&&(h.name={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[j].trim().length)},n=g(n,i.pos.match[j].length)),j+=1,i.pos.match[j]){var o=i.pos.match[j].indexOf(i.pos.match[j+1]);h["super"]={anchor:d.Pos(n.line,n.ch+o),head:d.Pos(n.line,n.ch+o+i.pos.match[j+1].trim().length)},n=g(n,i.pos.match[j].length)}if(j+=2,i.pos.match[j]){var o=i.pos.match[j].indexOf(i.pos.match[j+1]);h["interface"]={anchor:d.Pos(n.line,n.ch+o),head:d.Pos(n.line,n.ch+o+i.pos.match[j+1].trim().length)},n=g(n,i.pos.match[j].length)}}else{var n=g(i.pos.from,i.pos.match[1].length);i.pos.match[2]&&(h.visibility={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[3].trim().length)},n=g(n,i.pos.match[2].length)),i.pos.match[4]&&(h["static"]={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[5].trim().length)},h["abstract"]=h["static"],n=g(n,i.pos.match[4].length)),i.pos.match[6]&&(h.type={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[7].length)},n=g(n,i.pos.match[6].length)),h.name={anchor:n,head:d.Pos(n.line,n.ch+i.pos.match[8].length)}}m=h[c];break;case"body":m.anchor=g(m.start,1),m.head=m.end;break;case"whole":m.anchor=0==m.before.line&&0==m.before.ch?m.before:g(m.before,1),m.head=g(m.after,1);break;case"start":m.anchor=m.start;break;case"end":m.anchor=m.end;break;case"before":m.anchor=m.before;break;case"after":m.anchor=m.after;break;case"parameters":if(!m.parameters||!m["parameters end"])throw"Method "+a+" has no parameters.";m.anchor=m.parameters,m.head=m["parameters end"];break;case"parameters end":if(!m.parameters||!m["parameters end"])throw"Method "+a+" has no parameters.";m.anchor=m["parameters end"]}return m}var k,l=this.editor,m=c?i(c):null;return m=i(a,m),m=j(a,e,m)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.addClass=function(c,d){var e=this;d=d||a.bind(e.next,e),c=a.extend({wait:0},c||{}),b(c.selector).addClass(c["class"]),e.scrollToTarget(b(c.selector)),e.timer(function(){d()},c.wait)},c.prototype.availableActions.removeClass=function(c,d){var e=this;d=d||a.bind(e.next,e),c=a.extend({wait:0},c||{}),b(c.selector).removeClass(c["class"]),e.timer(function(){d()},c.wait)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer","tooltip"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer"),require("tooltip")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.popover=function(c,d){var e=this;if(d=d||a.bind(e.next,e),c=a.extend({wait:"click",hide:"same",attachment:"code",pos:"caret",selector:"",placement:"top","class":"",hideOthers:!1,locale:"en"},c||{}),this.locale&&c.locale!=this.locale)return d();var f,g=b(".CodeMirror-selected:first-child",b(e.editor.display.selectionDiv)),h=b(e.editor.display.wrapper).closest(".codeplayer");if("element"==c.attachment)f=c.selector instanceof jQuery?c.selector:".codeplayer-roadmap"==c.selector?b(c.selector,h):b(c.selector);else{if("code"==c.attachment||""==e.editor.getSelection()||void 0==g.offset()){var i=e.resolvePosition(c.pos);"bottom"==c.placement&&(i.y+=e.LINE_HEIGHT),"left"!=c.placement&&"right"!=c.placement||(i.y+=e.LINE_HEIGHT/2),f=b('<div class="tooltip-target"></div>'),f.css({left:i.x+"px",top:i.y+"px"}),this.$container.append(f)}else if("selection"==c.attachment){var i={x:g.offset().left,y:g.offset().top};if("top"!=c.placement&&"bottom"!=c.placement||(i.x+=g.width()/2),"left"!=c.placement&&"right"!=c.placement||(i.y+=g.height()/2),"bottom"==c.placement){var j=g;b(".CodeMirror-selected",b(e.editor.display.selectionDiv)).each(function(){b(this).offset().top>j.offset().top&&(j=b(this))}),i.x=j.offset().left,i.y=j.offset().top+j.height()}"right"==c.placement&&(i.x+=g.width()),f=b('<div class="tooltip-target"></div>'),f.css({left:i.x+"px",top:i.y+"px"}),this.$container.append(f)}this.$container[0]!=b("body")[0]&&f.css({top:i.y+this.$container.scrollTop()+"px"})}if(null!=f&&f.length){"element"==c.attachment&&f.attr("title")&&f.attr("data-orig-title",f.attr("title")).removeAttr("title",""),f.tooltip({title:c.text,placement:c.placement,trigger:"manual",html:!0,constraints:[{to:"window",attachment:"together",pin:!0}]}).tooltip("show"),e.tooltip_targets.push(f);var k=b("#"+f.attr("aria-describedby"));k.length||(k=this.$container.find(".tooltip").last()),k.addClass("codeplayer-tooltip");var l=b(".tooltip.codeplayer-tooltip");if(k.length){b("a",k).attr("target","_blank"),c["class"]&&k.addClass(c["class"]),e.scrollToTarget(k),e.fastForward&&(c.wait=0,c.hide="same");var m=function(){e.tooltip_targets.splice(a.indexOf(e.tooltip_targets,f),1),f.tooltip("dispose"),f.removeAttr("data-original-title"),f.is(".tooltip-target")?f.remove():f.attr("data-orig-title")&&f.attr("title",f.attr("data-orig-title")).removeAttr("data-orig-title"),c.hideOthers&&e.hidePopovers()};"none"!=c.hide&&e.cleanupFunc.push(m),a.isNumber(c.wait)&&e.timer(function(){"same"==c.hide&&m(),d()},c.wait),l.off("click").click(function(a){return"A"==a.target.tagName||(l.off("click"),("click"==c.hide||"click"==c.wait&&"same"==c.hide)&&m(),void("click"==c.wait&&d()))})}else d()}},c.prototype.availableActions.popover.init=function(){this.tooltip_targets=[]},c.prototype.availableActions.popover.reversable=!0,c.prototype.availableActions.popover.saveState=function(a){var b=[];this.tooltip_targets.forEach(function(a){b.push({target:a.is(".tooltip-target")?a.clone():a,tooltip:a.data("bs.tooltip").options})}),a.state.popovers=b},c.prototype.availableActions.popover.revertState=function(a){this.hidePopovers(),a.state.popovers&&a.state.popovers.forEach(function(a){$element=a.target,$element.is(".tooltip-target")&&this.$container.append($element),this.tooltip_targets.push(a.target),$element.tooltip(a.tooltip).tooltip("show")})},c.prototype.availableActions.hidePopovers=function(b,c){var d=this;c=c||a.bind(d.next,d),b=a.extend({wait:100},b||{}),d.hidePopovers(),d.timer(c,b.wait)},c.prototype.hidePopovers=function(){for(var a,b=this.tooltip_targets.length-1;b>=0;b--)a=this.tooltip_targets[b],this.tooltip_targets.splice(b,1),a.tooltip("dispose"),a.removeAttr("data-original-title"),a.is(".tooltip-target")?a.remove():a.attr("data-orig-title")&&a.attr("title",a.attr("data-orig-title")).removeAttr("data-orig-title")}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer","./popover"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.compile=function(c,d){var e=this;d=d||a.bind(e.next,e);var f=b(e.editor.display.wrapper).closest(".codeplayer");c=a.extend({success:!0,wait:1e3,popover:{}},c||{}),c.popover.wait=c.popover.wait||"click",c.popover.hide=c.popover.hide||"same",c.popover.attachment="element",c.popover.selector=b(".codeplayer-compile",f),c.popover.placement="right",void 0!==c.text&&(c.popover.text=c.text),c.popover.text=c.popover.text||(c.success&&void 0==c.popover.text?"<b>Все отлично, можем продолжать!</b>":""),c.popover.locale=c.locale;var g=function(){b(".codeplayer-compile",f).removeClass("active").removeClass("btn-danger").removeClass("btn-success"),b(".codeplayer-compile span",f).removeClass("fa-spin").addClass("fa-bug").removeClass("fa-cog")};e.cleanupFunc.push(g),e.hidePopovers(),b(".codeplayer-compile",f).addClass("active").addClass("btn-danger"),b(".codeplayer-compile span",f).addClass("fa-cog").removeClass("fa-bug").addClass("fa-spin"),e.timer(function(){b(".codeplayer-compile",f).removeClass("active").removeClass("btn-danger"),b(".codeplayer-compile span",f).removeClass("fa-spin").addClass("fa-bug").removeClass("fa-cog"),c.popover.text?(c.success?(c.popover["class"]+=" tooltip-success",b(".codeplayer-compile",f).addClass("btn-success")):(c.popover["class"]+=" tooltip-danger",b(".codeplayer-compile",f).addClass("btn-danger")),e.getAction("popover")(c.popover,function(){b(".codeplayer-compile",f).removeClass("btn-success").removeClass("btn-danger"),d()})):d()},c.wait)},c.prototype.availableActions.readyAndCompile=function(c,d){var e=this;if(d=d||a.bind(e.next,e),c=a.extend({success:!0,wait:1e3,waitForClick:!1,locale:"en"},c||{}),this.locale&&c.locale!=this.locale)return d();var f=b(e.editor.display.wrapper).closest(".codeplayer"),g=function(){e.cleanupFunc.push(function(){b(".codeplayer-compile",f).removeClass("blinking")}),b(".codeplayer-compile",f).addClass("blinking"),e.getAction("waitForClickOn")({selector:".codeplayer-compile, .tooltip",timeout:c.waitForClick?0:2e3},function(){b(".codeplayer-compile",f).removeClass("blinking"),e.getAction("compile")({success:c.success,wait:c.wait,text:c.text2,locale:c.locale},d)})};if(c.text){var h={attachment:"element",selector:b(".codeplayer-compile",f),placement:"right",wait:100,hide:"none",text:c.text,locale:c.locale};e.cleanupFunc.push(function(){e.hidePopovers()}),e.getAction("popover")(h,g)}else g()},c.prototype.availableActions.readyAndCompile.reversable=!0,c.prototype.availableActions.readyAndCompile.saveState=c.prototype.availableActions.popover.saveState,c.prototype.availableActions.readyAndCompile.revertState=function(a){b(".codeplayer-compile").removeClass("blinking"),c.prototype.availableActions.popover.revertState.call(this,a)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.indent=function(a,b){this.doIndent("add",a,b)},c.prototype.availableActions.deindent=function(a,b){this.doIndent("subtract",a,b)},c.prototype.doIndent=function(b,c,d){function e(){for(var a=0;a<c.times;a++)g.editor.indentSelection(b)}function f(){try{g.editor.indentSelection(b)}catch(a){}--h>0?g.timer(f,c.delay):d()}var g=this;d=d||a.bind(g.next,g),c=a.extend({delay:500,times:1},c||{});var h=c.times,i={value:g.editor.getValue(),cursor:g.editor.getCursor(),selection:g.editor.doc.listSelections()};this.cleanupFunc.push(function(){g.editor.setValue(i.value),g.editor.setCursor(i.cursor),g.editor.setSelections(i.selection),e()}),g.fastForward||0==c.delay?(e(),d()):g.timer(f,c.delay)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.jumpTo=function(b,c){var d=this;if(c=c||a.bind(d.next,d),b=a.extend({afterDelay:200},b||{}),!b.pos)throw'No position specified for "jumpTo" action';var e=d.resolvePosition(b.pos);d.scrollToTarget(e.y+d.LINE_HEIGHT),d.editor.setCursor(d.makePos(b.pos)),d.timer(c,b.afterDelay)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer","codemirror","../utils/syntax"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer"),require("codemirror"),require("../utils/syntax")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player,a.CodeMirror)}(this,function(a,b,c,d){c.prototype.availableActions.moveTo=function(b,c){function d(){h=f.editor.getCursor(!0),l>0&&(h.line!=i.line||h.ch!=i.ch)?(h.line!=i.line&&(h.line+=m),h.ch!=i.ch&&(h.ch+=n),f.editor.setCursor(h),f.scrollToTarget(f.editor.getCursor(),0),l--,f.timer(d,b.delay)):(f.editor.setCursor(i),f.scrollToTarget(f.editor.getCursor(),0),c())}var f=this;c=c||a.bind(f.next,f),b=a.extend({pos:null,location:"",parent:"",place:"",text:"",delay:80,immediate:!1},b||{});var g={};(b.location||b.place||b.text)&&(g=f.getLocationRange(b.location,b.parent,b.place,b.text),g=e(f.editor,g,b.location,b.parent,b.place,b.text),b.pos=g.anchor);var h=f.editor.getCursor(!0);f.editor.setSelection(h,h);var i=f.makePos(b.pos);if(b.immediate||!b.delay)return f.editor.setCursor(i),void c();console.log(i),this.cleanupFunc.push(function(){f.editor.setCursor(i),console.log("x"),console.log(i)});var j=i.line-h.line,k=i.ch-h.ch,l=Math.max(k,j),m=j<0?-1:1,n=k<0?-1:1;f.timer(d,b.delay);f.resolvePosition("caret")};var e=function(a,c,e,f,g,h){if(!h)return c;var i=b.extend({},c),j=h.replace(RegExp("\\|\\|\\|","g"),""),k=a.getSearchCursor(j,i.anchor,{caseFold:!0,multiline:!1});if(!k.findNext()||d.cmpPos(k.to(),i.head)>0){var l=e?'method/class "'+e+'" of the ':"";throw"Text can not be found in "+l+" source text. Searched for:\n```\n"+j+"\n```\n\n...inside:\n```\n"+a.doc.getRange(i.anchor,i.head)+"\n```"}i.anchor=k.from();var m=h.indexOf("|||");return m>-1&&(i.anchor=a.findPosH(i.anchor,m,"char",!1)),i}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.run=function(b,c){function d(){try{a.isFunction(b.command)?b.command(e.editor,b):e.editor.execCommand(b.command)}catch(g){}--f>0?e.timer(d,b.beforeDelay):c()}var e=this;c=c||a.bind(e.next,e),b=a.extend({beforeDelay:0,times:1},b||{});var f=b.times;e.timer(d,b.beforeDelay)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer","codemirror","../utils/syntax"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer"),require("codemirror"),require("../utils/syntax")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player,a.CodeMirror)}(this,function(a,b,c,d){c.prototype.availableActions.select=function(c,e){var f=this;if(e=e||a.bind(f.next,f),c=a.extend({afterDelay:0,add:!1},c||{}),c.location&&!c.place&&(c.place="whole"),c.location||c.place||c.text){var g,h,i,j=[];try{var k=f.getLocationRange(c.location,c.parent,c.place,c.text)}catch(l){return void console.error(l)}if(c.text){for(var m=c.text.replace(/\|\|\|/g,""),n=f.editor.getSearchCursor(m,k.anchor,{caseFold:!0,multiline:!1}),o=1;n.findNext()&&!(k.head&&d.cmpPos(n.to(),k.head)>0);){if(!c.index||c.index>0&&o==c.index){if(c.text.indexOf("|||")>-1)for(var p=c.text;p.indexOf("|||")>-1;)i=p.indexOf("|||"),g=f.editor.findPosH(n.from(),i,"char",!1),p=p.replace("|||",""),i=p.indexOf("|||"),h=f.editor.findPosH(n.from(),i,"char",!1),p=p.replace("|||",""),j.push({anchor:g,head:h});else j.push({anchor:n.from(),head:n.to()});if(c.index>0&&o==c.index)break}o++}if(!j.length)return void console.error("Text can not be found in %s source text. Searched for:\n```\n%s\n```\n\n...inside:\n```\n%s\n```",c.location?'method/class "'+c.location+'" of the ':"",m,f.editor.doc.getRange(k.anchor,k.head));if(c.add)for(var o=0;o<j.length;o++)f.editor.addSelection(j[o].anchor,j[o].head);else f.editor.setSelections(j,0)}else c.add?f.editor.addSelection(k.anchor,k.head):f.editor.setSelection(k.anchor,k.head)}else if(c.from&&c.to){var q=f.makePos(c.from),r=f.makePos(c.to);c.add?f.editor.addSelection(q,r):f.editor.setSelection(q,r)}""!=f.editor.getSelections().join("")&&f.scrollToTarget(b(".CodeMirror-selected:first-child",b(f.editor.display.selectionDiv))),f.timer(e,c.afterDelay)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.setStep=function(c,d){var e=this;d=d||a.bind(e.next,e),c=a.extend({step:1,wait:1e3},c||{}),c.wait=e.fastForward?0:c.wait;var f=b(e.editor.display.wrapper).closest(".codeplayer"),g=b(".codeplayer-roadmap",f);if(e.cleanupFunc.push(function(){e.setStep(c.step)}),e.step=c.step,this.fastForward||e.scrollToTarget(g),g.removeClass("fastForward"),"all"==c.step||a.isNumber(c.step)&&(c.step==-1||c.step>b(".codeplayer-roadmap .step",f).length))b(".step",g).removeClass("active").removeClass("transitioned").addClass("completed"),e.timer(function(){g.addClass("completed"),e.timer(function(){d()},c.wait)},c.wait);else if(a.isNumber(c.step)){for(var h=b(".step",g).length,i=1;i<c.step;i++)b(".step:nth-child("+i+")",g).removeClass("transitioned").removeClass("active").addClass("completed");for(var i=c.step+1;i<=h;i++)b(".step:nth-child("+i+")",g).removeClass("transitioned").removeClass("active").removeClass("completed");b(".step:nth-child("+c.step+")",g).removeClass("completed").addClass("active"),e.timer(function(){b(".step:nth-child("+c.step+")",g).addClass("transitioned"),d()},c.wait)}}}),
function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.type=function(b,c){function d(){var a=g.length?g.shift():"";"←"==a?f.editor.execCommand("delCharBefore"):"→"==a?f.editor.execCommand("delCharAfter"):f.editor.replaceSelection(a,"end")}function e(){var a="";b.text=b.text||"";var c=b.text.split("");do{var d=c.length?c.shift():"";"←"==d||"→"==d?(a.length&&f.editor.replaceSelection(a,"end"),"←"==d?f.editor.execCommand("delCharBefore"):"→"==d&&f.editor.execCommand("delCharAfter"),a=""):a+=d,c.length||(f.editor.replaceSelection(a,"end"),a="")}while(c.length)}var f=this;c=c||a.bind(f.next,f),b=a.extend({beforeDelay:0,delay:60,pos:"caret"},b||{}),null!==b.pos&&"caret"!==b.pos&&f.editor.setCursor(f.makePos(b.pos)),b.text=b.text||"";var g=b.text.split(""),h={value:f.editor.getValue(),cursor:f.editor.getCursor(),selection:f.editor.doc.listSelections()};this.cleanupFunc.push(function(){f.editor.setValue(h.value),f.editor.setCursor(h.cursor),f.editor.setSelections(h.selection),e()});var i=function(){f.fastForward||0==b.delay?(e(),c()):f.timer(function a(){var e=f.resolvePosition("caret");f.scrollToTarget(e.y+f.LINE_HEIGHT,0),d(),g.length?f.timer(a,b.delay):c()},b.delay)};f.fastForward||0==b.beforeDelay?i():f.timer(i,b.beforeDelay)}}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery","../codeplayer"],b):"object"==typeof exports?b(require("underscore"),require("jquery"),require("../codeplayer")):b(a._,a.jQuery||a.Zepto||a.ender||a.$,a.CodeMirror.player)}(this,function(a,b,c){c.prototype.availableActions.wait=function(b,c){var d=this;c=c||a.bind(d.next,d),b=a.extend({timeout:100},b||{}),d.timer(c,parseInt(b.timeout,10))},c.prototype.availableActions.waitForClickOn=function(c,d){var e=this;if(d=d||a.bind(e.next,e),e.fastForward)return void d();c=a.extend({selector:"",timeout:0},c||{});var f=function(){void 0!=g&&clearTimeout(g),b(c.selector).off("click",f),d()};if(b(c.selector).on("click",f),c.timeout)var g=e.timer(f,c.timeout)}});